# Техническое задание: Лабиринтные задания (Maze Puzzles)

## Обзор

Новый тип заданий в разделе puzzles - "Лабиринт", где шахматная фигура должна выйти из лабиринта, следуя правилам движения конкретной фигуры.

## Основные требования

### Конфигурация игры

Каждое лабиринтное задание настраивается через конфиг файл со следующими параметрами:

1. **Номер задания** - уникальный идентификатор
2. **Начальная позиция** - расположение всех элементов в FEN-подобном формате (включая тип и цвет фигуры)
3. **Ограничение по ходам** - максимальное количество ходов (опционально)
4. **Временное ограничение** - максимальное время на прохождение (опционально)

**Пример начальной позиции:**

```
initialPosition: "E6C/WWWW1WWW/8/8/8/2W1W3/WWW1WWW1/R7 w - - 0 1"
```

Где:

- **E** = выход
- **C** = контрольная точка
- **W** = стена
- **R** = белая ладья (фигура игрока)
- **Цифры** = пустые клетки

**Важно:** Фигура никогда не стоит на контрольной точке в начале игры. Стартовая клетка и клетка выхода не могут совпадать.

### Игровая механика

#### Базовые правила:

- Используется стандартная шахматная доска 8x8
- Фигура движется согласно своим шахматным правилам
- Стены блокируют движение — фигура не может встать на стену или пройти через неё; стены не могут быть побиты и не считаются фигурами
- Конь может перепрыгивать стены, но не может остановиться на стене
- Пешка может получить промоушен при достижении противоположной стороны доски. Появляется стандартное окно выбора фигуры (ферзь, ладья, слон, конь), так как игрок может выбрать, например, коня чтобы перепрыгнуть через стену. После промоушена фигура продолжает двигаться по правилам новой фигуры
- В лабиринте ходит только игрок; первым всегда ходит игрок

#### Условия победы:

- Фигура должна достичь любого из выходов
- Если есть контрольные точки - все должны быть пройдены перед активацией выходов
- **Важно**: Пока не пройдены все контрольные точки, выход считается обычной свободной клеткой

#### Условия поражения:

- У фигуры нет доступных ходов
- Превышено ограничение по количеству ходов (если установлено)
- Превышено временное ограничение (если установлено)

#### UI элементы:

- Счетчик оставшихся контрольных точек (если есть) - отображается над доской
- Обратный отсчет оставшихся ходов (если установлен лимит) - отображается над доской
- Таймер времени (если задан лимит времени) - отображается над доской
- Визуальное отображение стен, выходов и контрольных точек

## Анализ требований пользователя

### ✅ Четко определено:

1. Основная концепция лабиринта
2. Система конфигурации через файл
3. Обязательные элементы (стены, выходы)
4. Опциональные элементы (контрольные точки, лимит ходов)
5. Базовые правила движения фигур
6. Условия победы и поражения

### ✅ Уточнено и решено:

#### 1. **Визуальное представление**

- ✅ **Стены**: Отображаются буквой "W" на клетках (временно, до готовности дизайна)
- ✅ **Выходы**: Отображаются буквой "E" на клетках. **Неактивные выходы отображаются красной буквой "E"** (временно, до готовности дизайна)
- ✅ **Контрольные точки**: Отображаются буквой "C" на клетках. **Звуковой сигнал при прохождении не нужен** (временно, до готовности дизайна)

#### 2. **Пользовательский интерфейс**

- ✅ **Счетчики**: Размещаются над доской в текстовом формате (временно, до готовности дизайна)
- ✅ **Подсказки**: Показывать доступные ходы по клику на фигуру (как в игре с компьютером)
- ✅ **Кнопка отключения подсказок**: Добавить возможность отключить подсказки
- ✅ **Кнопка "Начать заново"**: Добавить как в других играх

#### 3. **Игровая логика**

- ✅ **Прохождение контрольных точек**: Фигура должна **стать на контрольную точку**. После этого точка становится обычной клеткой, отметка исчезает, счетчик уменьшается (например: было 2, стало 1)
- ✅ **Взятие контрольных точек**: Пешка может занять клетку с контрольной точкой **как обычным ходом вперед, так и по диагонали** (как при взятии фигуры соперника)
- ✅ **Порядок контрольных точек**: Можно проходить в любом порядке
- ✅ **Активация выходов**: Выходы активируются только после прохождения ВСЕХ контрольных точек. Если контрольных точек нет - выход доступен сразу

#### 4. **Техническая реализация**

- ✅ **Компонент доски**: Использовать существующую библиотеку доски
- ✅ **Отдельный компонент**: Создать отдельный компонент для лабиринтов (из-за отсутствия финального дизайна)
- ✅ **Интеграция с существующей системой puzzles**: Добавить 4-ую кнопку на главной странице пазлов для перехода на страницу с лабиринтными заданиями. Конфигурация заданий (расположение объектов, стартовая фигура и позиция, стены, выходы) будут в отдельном файле
- ✅ **Движок для лабиринтов**: Создать отдельный движок для лабиринтов
- ✅ **Сохранение прогресса игрока**: Создать отдельный объект в Redux для хранения прогресса. В будущем при готовности API - сохранение в базе данных с последующей загрузкой в Redux

### ✅ Все детали определены:

#### 5. **Локализация**

- ✅ **Ключи для названий и описаний заданий**: Будут создаваться по ходу разработки (например: "дойдите до выхода", "пройдите контрольные точки и потом на выход" и т.д.)
- ✅ **Тексты для UI элементов (счетчики, подсказки)**: Будут создаваться по ходу необходимости. Примеры: "Пройдите контрольные точки: 2", "У вас осталось: 6 ходов"
- ✅ **Сообщения об ошибках и победе**: "Вы выиграли!", "У вас больше не осталось ходов"

#### 6. **Сложность и прогрессия**

- ✅ **Уровни сложности**: Нет уровней сложности, есть только задания которые идут одно за одним
- ✅ **Система оценки прогресса**: Показывает количество пройденных заданий (например: пройдено 48 из 100 = 48%)

#### 7. **Дополнительные возможности**

- ✅ **Поддержка нескольких фигур одновременно**: Нет, у игрока только одна фигура в игре
- ✅ **Движущиеся стены или препятствия**: Нет, ходит только игрок своей фигурой (как в how to move)
- ✅ **Временные ограничения**: Можно добавить таймер как необязательный параметр (например: пройти лабиринт за 2 минуты)
- ✅ **Режим редактора лабиринтов**: Пока не планируется, но отметить как будущее TODO для развития

## Предлагаемая структура данных

```typescript
interface MazePuzzle {
  id: string;
  titleKey: string;
  descriptionKey: string;
  initialPosition: string; // Позиция в FEN-подобном формате: "E6C/WWWW1WWW/8/8/8/2W1W3/WWW1WWW1/R7 w - - 0 1"
  maxMoves?: number; // Максимальное количество ходов (необязательно)
  timeLimit?: number; // Временное ограничение в секундах (необязательно)
  hintKey: string;
}
```

## Следующие шаги

1. ✅ Техническое задание полностью готово
2. Создать типы TypeScript для лабиринтных заданий
3. Создать отдельный движок для лабиринтов (MazeEngine)
4. Разработать компонент MazeBoard
5. Создать Redux slice для прогресса лабиринтов
6. Интегрировать с существующей системой puzzles (добавить 4-ю кнопку)
7. Создать набор тестовых лабиринтов
8. Провести тестирование и отладку

## Будущие улучшения

### Оптимизация FEN-формата

В будущем можно упростить формат `initialPosition`, убрав лишние части FEN-строки:

**Текущий формат:**

```
"E6C/WWWW1WWW/8/8/8/2W1W3/WWW1WWW1/R7 w - - 0 1"
```

**Предлагаемый упрощенный формат:**

```
"E6C/WWWW1WWW/8/8/8/2W1W3/WWW1WWW1/R7"
```

Оставшиеся части (`w - - 0 1`) не нужны для лабиринтных заданий, так как:

- Чей ход всегда у игрока
- Рокировка не применима
- Взятие на проходе не применимо
- Счетчики ходов не нужны
